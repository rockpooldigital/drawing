<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	  
	  <!-- Lots of apple specific stuff! -->
		<meta name="apple-mobile-web-app-capable" content="yes"/>
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
		<link rel="apple-touch-icon" sizes="57x57" href="/img/icons/apple-touch-icon-57x57.png"/>
		<link rel="apple-touch-icon" sizes="72x72" href="/img/icons/apple-touch-icon-72x72.png"/>
		<link rel="apple-touch-icon" sizes="114x114" href="/img/icons/apple-touch-icon-114x114.png"/>
		<link href="/css/reset.css" rel="stylesheet" type="text/css" >
		<!-- GOogle fonts - Corben & Nobile -->
		<link href="//fonts.googleapis.com/css?family=Corben:bold" rel="stylesheet" type="text/css">
		<link href="//fonts.googleapis.com/css?family=Nobile" rel="stylesheet" type="text/css">
		<link href="/css/html5bp.main.css" rel="stylesheet" type="text/css" >
		<link href="/css/host.css" rel="stylesheet" type="text/css" >
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/knockout/2.1.0/knockout-min.js" type="text/javascript"></script>
		<script src="/js/Data.js" type="text/javascript"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="/js/drawingHost.js" type="text/javascript"></script>

		<script src="/js/drawing/Surface.js"></script>
		
	</head>

	<body>
		<div data-bind="ifnot: initialised">
			Please wait spinny spinny
		</diV>
		<div data-bind="if:initialised">
				<section id="main">
					<div id="gameState">State of game: <span data-bind="text: state"></span></div>

					<div id="currentPlayer" data-bind="if: currentPlayer, visible : currentPlayer">Current Player: <strong data-bind="text: currentPlayer().name()"></strong></div>

					<img src="/img/pencil.png" alt="Let's draw" id="logo" />
					<h1 id="mainTitle">draw</h1>
					<div id="canvasWrapper" class="clearfix">
						<canvas id="theCanvas"></canvas>
					</div>

				</section>

				<aside id="supporting">
					<!-- <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rerum veniam saepe placeat nam distinctio tempora id voluptatem hic maxime tenetur nihil expedita omnis magnam repellat odio quo animi consequuntur blanditiis!</p> -->
					<section id="timerWrapper">
						<img src="/img/spinner.png" id="spinner" alt="" />
						<time datetime="" id="timerSecs">60</time>

					
					</section>


					<section id="playerScores" data-bind="if: players().length > 0">
						<h2>Scores</h2>
						<button data-bind="enable : players().length >= 2 && state() === 'waiting', click : startGame">Start Game</button> 
						<ol data-bind="foreach: players">
							<li>
								<span class="name" data-bind="text: name" ></span>:
								<span class="score" data-bind="text: score"></span> Points
							</li>
						</ol>
					</section>
					<section id="join" class="mini" >
						<h2 class="title">Join in</h2>
						<img 
							data-bind="attr: { src : 'https://chart.googleapis.com/chart?cht=qr&amp;chs=500x500&amp;chl=' + encodeURIComponent(joinUrl())  }"
							 id="theQRCode" alt="Scan the code to join in"/>
						<p class="joinNow">Or type <strong data-bind="text: id"></strong></p>
						<p> debug: url is 
							<a data-bind="attr: { href: joinUrl }" >this</a>
						</p>
					</section>

				</aside>
			</div>
		
		<script>
			t = document.getElementById('timerSecs');
			w = document.getElementById('timerWrapper');
			s = t.innerText;

			start = function(secs){
				if(secs !== undefined){
					s = parseInt(secs); // start the timer with a new countdown
					t.innerHTML = s;
				}
				w.classList.add("spin");
				interval();
				
			}
			stop = function(){
				w.classList.remove("spin");
				window.clearInterval(i);
			}

			interval = function(){
				i = window.setInterval(function() {
					if(s == 0){
						stop();
						return;
					}else{
						s--;
						t.innerText = s;
					}
				}, 1000); // every second
			}
			jQuery(function($) {
				drawingHost.init(document.body, 
					'<%= gameId %>',
					'<%= joinUrl %>');
			})
		</script>
	</body>
</html>